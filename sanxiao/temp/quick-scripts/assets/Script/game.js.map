{"version":3,"sources":["game.js"],"names":["cc","Class","extends","Component","properties","Col","Row","Padding","SpacingX","SpacingY","ai","default","type","Prefab","pSet","aii","mii","onLoad","buildSet","init","check","node","i","arr","mrr","j","ele","instantiate","setPosition","x","y","addChild","addTouchEvents","com","getComponent","pos","v2","push","checkConnected","del","eleSize","getContentSize","beginX","width","beginY","height","position","p1","p2","on","event","select","getLocationX","getLocationY","PositionToPos","isAround","changeTwoPos","Math","floor","dis","abs","t","die","upData","count1","colConnected","count2","rowConnected","index1","index2","start","end","count","length","sf","begin","onoff","act","sequence","blink","scaleBy","runAction","splice","finished","callFunc","target","moveTo"],"mappings":"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","file":"game.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        Col:0, //纵列\r\n        Row:0, //排列\r\n        Padding:0,//元素填充大小\r\n        SpacingX:0,//横间隔    \r\n        SpacingY:0,//竖间隔\r\n        ai:{ //预制元素\r\n            default:null,\r\n            type:cc.Prefab\r\n        },\r\n        \r\n    },\r\n   \r\n    pSet:null,//坐标矩阵集合\r\n    aii:null,\r\n    mii:null,\r\n    onLoad: function () {\r\n        this.buildSet();\r\n        this.init();\r\n        this.check();\r\n        \r\n    },\r\n    init:function(){//初始化函数，生成元素节点，添加监听事件\r\n        var node=this.node;\r\n        this.aii=[];\r\n        this.mii=[];\r\n        var pSet=this.pSet;\r\n        for(var i=0;i<this.Row;i++){\r\n            var arr=[];\r\n            var mrr=[];\r\n            for(var j=0;j<this.Col;j++){\r\n                var ele=cc.instantiate(this.ai);\r\n                ele.setPosition(pSet[i][j].x,pSet[i][j].y);\r\n                node.addChild(ele,0,\"ele\");\r\n                this.addTouchEvents(ele);\r\n                var com=ele.getComponent('ai');\r\n                com.pos=cc.v2(i,j);\r\n                arr.push(ele);\r\n                mrr.push(0);\r\n            }\r\n            this.mii.push(mrr);\r\n            this.aii.push(arr);\r\n        }\r\n    },\r\n    check:function(){//检测条件\r\n        if(this.checkConnected()){\r\n            this.del();\r\n        }\r\n    },\r\n\r\n    buildSet:function(){//生成每个元素的坐标点对象\r\n        var ele=cc.instantiate(this.ai);\r\n        var eleSize=ele.getContentSize();\r\n        var beginX=(this.node.width-(this.Row-1)*(this.SpacingX+eleSize.width))/2;\r\n        var beginY=this.Padding+eleSize.height/2;\r\n        \r\n        this.pSet=[];        \r\n        for(var i=0;i<this.Row;i++){\r\n            var arr=[];\r\n            for(var j=0;j<this.Col;j++){\r\n                var position=cc.v2(beginX+i*(eleSize.width+this.SpacingX),beginY+j*(eleSize.height+this.SpacingY));\r\n                arr.push(position);\r\n            }\r\n            this.pSet.push(arr);\r\n        }\r\n        \r\n    },\r\n    addTouchEvents:function(node){//触摸事件\r\n        var p1=null;\r\n        var p2=null;\r\n        node.on('touchstart',function(event){//传回节点位置\r\n            node.select=true;\r\n            p1=node.getComponent('ai').pos;\r\n        },this);\r\n        node.on('touchmove',function(event){\r\n            if(node.select){\r\n                var x=event.getLocationX();\r\n                var y=event.getLocationY();\r\n                node.setPosition(x,y);\r\n            }\r\n        },this);\r\n        node.on('touchend',function(event){\r\n            node.select=false;\r\n            var x=event.getLocationX();\r\n            var y=event.getLocationY();\r\n            p2=this.PositionToPos(x,y);\r\n            if(this.isAround(p1,p2)&&typeof(this.aii[p2.x][p2.y])!='undefined'){\r\n                this.changeTwoPos(p1,p2);\r\n                this.check();     \r\n            }else{\r\n                node.setPosition(this.pSet[p1.x][p1.y]);\r\n            }\r\n        },this);\r\n\r\n    },\r\n    \r\n    PositionToPos:function(x,y){//屏幕坐标转矩阵坐标\r\n        var ele=cc.instantiate(this.ai);\r\n        var eleSize=ele.getContentSize();\r\n        var pos=cc.v2(Math.floor((x-this.Padding)/(eleSize.width+this.SpacingX)),Math.floor((y-this.Padding)/(eleSize.height+this.SpacingY)));\r\n        return pos;\r\n    },\r\n    isAround:function(p1,p2){//判断矩阵坐标p2是否与p1相邻\r\n        var dis=Math.abs((p2.x-p1.x)+(p2.y-p1.y));\r\n        if(dis==1){\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n    changeTwoPos:function(p1,p2){//交换两个ai的位置 包括自身存储的位置信息与aii数组内的实例交换\r\n        this.aii[p1.x][p1.y].getComponent('ai').pos=p2;\r\n        this.aii[p1.x][p1.y].setPosition(this.pSet[p2.x][p2.y]);\r\n        this.aii[p2.x][p2.y].getComponent('ai').pos=p1;\r\n        this.aii[p2.x][p2.y].setPosition(this.pSet[p1.x][p1.y]);\r\n        var t=this.aii[p1.x][p1.y];\r\n        this.aii[p1.x][p1.y]=this.aii[p2.x][p2.y];\r\n        this.aii[p2.x][p2.y]=t;\r\n        \r\n        \r\n    },\r\n    del:function(){\r\n        \r\n        this.die();\r\n        this.upData();\r\n\r\n    },\r\n    checkConnected:function(){//检测元素相连\r\n        var count1=this.colConnected();\r\n        var count2=this.rowConnected();\r\n        \r\n        return ((count1+count2)>0)?true:false;\r\n    },\r\n\r\n    colConnected:function(){//纵列元素的相连情况\r\n        var index1,index2;\r\n        var start,end;\r\n        var count=0;//记录需要删除的star数\r\n        for(var i=0;i<this.aii.length;i++){\r\n            if(typeof(this.aii[i][0])=='undefined'){\r\n                continue;\r\n            }\r\n            index1=this.aii[i][0].getComponent('ai').sf;\r\n            start=0;\r\n            for(var j=1;j<=this.aii[i].length;j++){\r\n                if(j==this.aii[i].length){//当到达边界值时\r\n                    index2=-1;\r\n                }else{\r\n                    index2=this.aii[i][j].getComponent('ai').sf;\r\n                }\r\n                \r\n                if(index1!=index2){\r\n                    end=j;\r\n                    if(end-start>=3){\r\n                        while(start!=end){\r\n                            this.mii[i][start]=1;\r\n                            start++;\r\n                            count++;\r\n                        }\r\n                    }\r\n                    start=end;\r\n                    if(start!=this.aii[i].length){\r\n                        index1=this.aii[i][start].getComponent('ai').sf;\r\n                    }\r\n                    \r\n                }\r\n            }\r\n        }\r\n        return count;\r\n    },\r\n    rowConnected:function(){//横列元素的相连情况\r\n        var index1,index2;\r\n        var start,end;\r\n        var count=0;//记录需删除的star数\r\n        for(var j=0;j<this.Col;j++){\r\n            for(var i=0;i<this.Row;){\r\n                if(typeof(this.aii[i][j])=='undefined'){\r\n                    i++;\r\n                    continue;\r\n                }\r\n                index1=this.aii[i][j].getComponent('ai').sf;\r\n                var begin=i;\r\n                end=begin;\r\n                while(end<this.Row){\r\n                    if(typeof(this.aii[end][j])=='undefined'){\r\n                        if(end-begin>=3){\r\n                            while(begin!=end){ \r\n                                if(this.mii[begin][j]!=1){\r\n                                    this.mii[begin][j]=1;\r\n                                    count++;\r\n                                }\r\n                                begin++;\r\n                            }\r\n                        }\r\n                        break;\r\n                    }\r\n                    index2=this.aii[end][j].getComponent('ai').sf;\r\n                    if(index1!=index2){\r\n                        if(end-begin>=3){\r\n                            while(begin!=end){ \r\n                                if(this.mii[begin][j]!=1){\r\n                                    this.mii[begin][j]=1;\r\n                                    count++;\r\n                                }\r\n                                begin++;\r\n                            }\r\n                        }\r\n                        break;\r\n                    }\r\n                    end++;\r\n                }\r\n                if(end==this.Row&&end-begin>=3){\r\n                    while(begin!=end){ \r\n                        if(this.mii[begin][j]!=1){\r\n                            this.mii[begin][j]=1;\r\n                            count++;\r\n                        }\r\n                        begin++;\r\n                    }\r\n                }\r\n                i=end;\r\n                \r\n            }\r\n        }\r\n        return count;\r\n    },\r\n\r\n    die:function(){//根据mii的状态信息删除相连的元素\r\n        \r\n        for(var i=0;i<this.Row;i++){\r\n            var count=0;\r\n            var start=0,end;\r\n            var onoff=true;\r\n            for(var j=this.Col-1;j>=0;j--){\r\n                if(this.mii[i][j]==1){\r\n                    if(onoff){\r\n                        start=j;\r\n                        onoff=false;\r\n                    }\r\n                    var act=cc.sequence(cc.blink(0.2,1),cc.scaleBy(0.5,0,0));//消失动画\r\n                    this.aii[i][j].runAction(act);\r\n                }\r\n                if((this.mii[i][j-1]!=1||j-1<0)&&onoff==false){\r\n                    end=j;\r\n                    this.aii[i].splice(end,start-end+1);//删除ai实例\r\n                    \r\n                    onoff=true;\r\n                }\r\n                this.mii[i][j]=0;\r\n            }\r\n        }\r\n       \r\n    },\r\n\r\n    upData:function(){//下落动画以及更新位置\r\n        var finished=cc.callFunc(function(target){\r\n            this.check();\r\n            \r\n        },this);\r\n\r\n        for(var i=0;i<this.aii.length;i++){\r\n            for(var j=0;j<this.aii[i].length;j++){\r\n                if(i==this.aii.length-1&&j==this.aii[i].length-1){\r\n                    var act=cc.sequence(cc.moveTo(1,this.pSet[i][j]),finished);\r\n                }else{\r\n                    var act=cc.moveTo(1,this.pSet[i][j]);\r\n                }\r\n                this.aii[i][j].runAction(act);\r\n                var com=this.aii[i][j].getComponent('ai');\r\n                com.pos=cc.v2(i,j);\r\n\r\n            }\r\n        }\r\n        \r\n    },\r\n   \r\n\r\n    \r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n});\r\n"]}